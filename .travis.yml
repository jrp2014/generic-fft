language: haskell
dist: trusty

cache:
  directories:
    - $HOME/.cabal/packages
    - $HOME/.cabal/store

before_cache:
    - rm -fv $HOME/.cabal/packages/hackage.haskell.org/build-reports.log
    # remove files that are regenerated by 'cabal update'
    - rm -fv $HOME/.cabal/packages/hackage.haskell.org/00-index.*
    - rm -fv $HOME/.cabal/packages/hackage.haskell.org/*.json
    - rm -fv $HOME/.cabal/packages/hackage.haskell.org/01-index.cache
    - rm -fv $HOME/.cabal/packages/hackage.haskell.org/01-index.tar
    - rm -fv $HOME/.cabal/packages/hackage.haskell.org/01-index.tar.idx

    - rm -rfv $HOME/.cabal/packages/head.hackage

cabal: "2.4"

matrix:
  include:
    - ghc: "8.6.3"
    - ghc: "8.4.4"
    - ghc: "8.2.2"
    - ghc: "8.0.2"
    - ghc: "7.10.3"
    - ghc: "7.8.4"
    - ghc: "7.6.3"

install:
  - cabal --version
  - ghc --version

script:
  - cabal v2-update
  - rm -fv cabal.project cabal.project.local
# add -v or -v2 to the following to get more detail
  - cabal v2-configure --enable-tests --enable-benchmarks
  - cabal v2-build
#  - cabal v2-test
#  - cabal v2-bench
  - DISTDIR=$(mktemp -d /tmp/dist-test.XXXX)
  - cabal v2-sdist
  - mv dist-newstyle/sdist/*.tar.gz ${DISTDIR}
  - cd ${DISTDIR} || false
  - find . -maxdepth 1 -name '*.tar.gz' -exec tar -xvf '{}' \;
